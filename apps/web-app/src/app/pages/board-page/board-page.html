<!-- prettier-ignore -->
@let tooltips = { 
    creator: "Board created by you",
    visible_local: "Local board, not visible or available for others and on other devices.",
    visible_unlisted: "Unlisted board, only visible to you and whoever you share the link with.",
    visible_public: "Public board, visible to those who visit your profile.",
    deadline_going: "The board has a deadline of",
    deadline_expired: "The board wasn't completed by",
    deadline_none: "The board doesn't have a deadline",
    grid_mode_grid: "Switch to list view",
    grid_mode_list: "Switch to grid view",
    game_mode_bingo: "Bingo game mode. Get one strike.",
    game_mode_todo: "TODO game mode. Check all cells.",
    edit_button: "Edit button for changing the board name, game mode, deadline, deleting it and such.", 
};
@let switchTo = gridMode === 'grid' ? 'list' : 'grid';
@let buttonLabel = 'Switch to ' + switchTo + ' view';
@let deadline = "none";
@let totalCells = board().Cells.length;

<div>
  <h3>
    <img
      class="icon"
      src="{{ board().GameMode === 'todo' ? 'todo' : 'bingo' }}.svg"
      [matTooltip]="board().GameMode === 'todo' ? tooltips['game_mode_todo'] : tooltips['game_mode_bingo']"
      alt="{{ board().GameMode === 'todo' ? tooltips['game_mode_todo'] : tooltips['game_mode_bingo'] }}" /><span
      >{{ board().Name || "Untitled Board" }}</span
    >
  </h3>
  @if (pendingSelectCount() !== 0) {
  <div class="actions">
    <button mat-button (click)="unselect()">Unselect</button>
    <button mat-flat-button (click)="saveSelected()">Save ({{ pendingSelectCount() }})</button>
  </div>
  } @else if (!editMode) {
  <button
    matIconButton
    (click)="editBoard()"
    attr.aria-label="{{ tooltips['edit_button'] }}"
    [matTooltip]="tooltips['edit_button']">
    <mat-icon>edit</mat-icon>
  </button>
  } @else {
  <div class="actions">
    <button mat-button (click)="cancelChanges()">Cancel</button>
    <button mat-flat-button (click)="saveChanges()">Save</button>
  </div>
  }
</div>

<div>
  @if (editMode) {
  <mat-checkbox [(ngModel)]="doDelete">Delete board</mat-checkbox>
  <button matButton disabled>Create copy</button>
  } @else {

  <!-- prettier-ignore -->
  <div>
    <mat-icon fontSet="material-symbols-outlined" [matTooltip]="tooltips['creator']"
      >person</mat-icon>
    <span class="cdk-visually-hidden">{{ tooltips["creator"] }}</span>

    @switch (board().Visibility) { 
      @case ('local') {
        <mat-icon fontSet="material-symbols-outlined" [matTooltip]="tooltips['visible_local']"
        >visibility_off</mat-icon>
        <span class="cdk-visually-hidden">{{ tooltips["visible_local"] }}</span>
      } @case ('unlisted') {
        <mat-icon fontSet="material-symbols-outlined" [matTooltip]="tooltips['visible_unlisted']"
        >visibility_lock</mat-icon>
        <span class="cdk-visually-hidden">{{ tooltips["visible_unlisted"] }}</span>
      } @case ('public') {
        <mat-icon fontSet="material-symbols-outlined" [matTooltip]="tooltips['visible_public']"
        >visibility</mat-icon>
        <span class="cdk-visually-hidden">{{ tooltips["visible_public"] }}</span>
      }
    }
    
    @switch ($any(deadline)) { 
        @case ('pending') {
          <mat-icon fontSet="material-symbols-outlined" [matTooltip]="tooltips['deadline_going']"
            >hourglass_top</mat-icon>
          <span class="cdk-visually-hidden">{{ tooltips["deadline_going"] }}</span>
          } @case ('expired') {
          <mat-icon fontSet="material-symbols-outlined" [matTooltip]="tooltips['deadline_expired']"
            >hourglass_bottom</mat-icon>
          <span class="cdk-visually-hidden">{{ tooltips["deadline_expired"] }}</span>
          } @case ('none') {
          <mat-icon fontSet="material-symbols-outlined" [matTooltip]="tooltips['deadline_none']"
            >hourglass_disabled</mat-icon>
          <span class="cdk-visually-hidden">{{ tooltips["deadline_none"] }}</span>
        }
    }

  @if (goalReached()) {
    <mat-icon fontSet="material-symbols-outlined" class="trophy" matTooltip="Goal reached"
      >trophy</mat-icon>
  } @else { 
    <svg
      matTooltip="{{ boardStats().checkedCells + '/' + totalCells + ' cells checked' }}"
      viewBox="0 0 100 100"
      width="24px"
      height="24px"
      style="--chart-green: {{ (boardStats().bingoCells / totalCells) * 360 }}deg;
                --chart-yellow: {{ (boardStats().checkedCells / totalCells) * 360 }}deg;
                --chart-blue: {{ ((boardStats().checkedCells + pendingSelectCount()) / totalCells) * 360 }}deg">
      <defs>
        <mask id="smallmask">
          <circle cx="50" cy="50" r="45" fill="white" />
          <circle cx="50" cy="50" r="30" />
        </mask>
      </defs>

      <foreignObject x="0" y="0" width="100" height="100" mask="url(#smallmask)">
        <div class="gradient" xmlns="http://www.w3.org/1999/xhtml"></div>
      </foreignObject>
    </svg>
    }

    <button matIconButton disabled (click)="(null)">
      <mat-icon>history</mat-icon>
    </button>
  </div>

  <button
    disabled
    [matTooltip]="buttonLabel"
    attr.aria-label="{{ buttonLabel }}"
    matIconButton
    (click)="gridMode === 'grid' ? (gridMode = 'list') : (gridMode = 'grid')">
    <mat-icon>{{ gridMode === "grid" ? "list" : "grid_on" }}</mat-icon>
  </button>
  }
</div>

@if (goalReached()) {
<div>
  @if (board().GameMode === 'traditional') { BINGO!
  <button matButton (click)="continueAfterBingo()">Continue in TODO mode</button>
  } @else { You did it all! }
</div>
{{ isLocal() ? "This is a local board. You have to delete it to start a new one." : "" }}
}

<app-board
  [(cards)]="cells"
  [previewMode]="goalReached() || editMode ? 'preview' : null"></app-board>
